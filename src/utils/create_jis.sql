/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 03-jun.-2021 7:15:05 p. m. 				*/
/*  DBMS       : MySql 						*/
/* ---------------------------------------------------- */

SET FOREIGN_KEY_CHECKS=0 
;

/* Drop Tables */

DROP TABLE IF EXISTS `CATEGORIA` CASCADE
;

DROP TABLE IF EXISTS `DETALLE_FACTURA` CASCADE
;

DROP TABLE IF EXISTS `DETALLE_INFORME` CASCADE
;

DROP TABLE IF EXISTS `DETALLE_VENTA` CASCADE
;

DROP TABLE IF EXISTS `FACTURA` CASCADE
;

DROP TABLE IF EXISTS `INFORME` CASCADE
;

DROP TABLE IF EXISTS `PRODUCTO` CASCADE
;

DROP TABLE IF EXISTS `REGISTRO_VENTA` CASCADE
;

/* Create Tables */

CREATE TABLE `CATEGORIA`
(
	`ID_CATEGORIA` INT NOT NULL AUTO_INCREMENT,
	`NOMBRE` VARCHAR(100) NOT NULL,
	`DESCRIPCION` VARCHAR(200) NULL,
	CONSTRAINT `PK_CATEGORIA` PRIMARY KEY (`ID_CATEGORIA` ASC)
)

;

CREATE TABLE `DETALLE_FACTURA`
(
	`ID_FACTURA` INT NOT NULL,
	`ID_PRODUCTO` INT NOT NULL,
	`CANTIDAD_X_PRODUCTO` DECIMAL(5,0) NOT NULL,
	`VALOR_PRODUCTO` DECIMAL(12,2) NOT NULL,
	`GANANCIA` DECIMAL(4,1) NOT NULL
)

;

CREATE TABLE `DETALLE_INFORME`
(
	`ID_INFORME` INT NULL,
	`ID_REGISTRO` INT NULL
)

;

CREATE TABLE `DETALLE_VENTA`
(
	`ID_REGISTRO` INT NULL,
	`ID_PRODUCTO` INT NULL,
	`CANTIDAD` DECIMAL(5,0) NOT NULL,
	`VALOR_X_CANT` DECIMAL(12,2) NOT NULL
)

;

CREATE TABLE `FACTURA`
(
	`ID_FACTURA` INT NOT NULL AUTO_INCREMENT,
	`FECHA` DATE NOT NULL,
	`VALOR_FACTURA` DECIMAL(12,2) NOT NULL,
	CONSTRAINT `PK_FACTURA` PRIMARY KEY (`ID_FACTURA` ASC)
)

;

CREATE TABLE `INFORME`
(
	`ID_INFORME` INT NOT NULL AUTO_INCREMENT,
	`FECHA` DATE NOT NULL,
	`CANT_VENTAS` DECIMAL(5,0) NULL,
	`TOTAL_VENDIDO` DECIMAL(13,2) NULL,
	CONSTRAINT `PK_INFORME` PRIMARY KEY (`ID_INFORME` ASC)
)

;

CREATE TABLE `PRODUCTO`
(
	`ID_PRODUCTO` INT NOT NULL AUTO_INCREMENT,
	`NOMBRE` VARCHAR(100) NOT NULL,
	`PRECIO` DECIMAL(10,2) NOT NULL,
	`STOCK` INT NOT NULL,
	`MARCA` VARCHAR(50) NULL,
	`DESCRIPCION` VARCHAR(200) NULL,
	`REFERENCIA` VARCHAR(100) NULL,
	`ID_CATEGORIA` INT NULL,
	CONSTRAINT `PK_PRODUCTO` PRIMARY KEY (`ID_PRODUCTO` ASC)
)

;

CREATE TABLE `REGISTRO_VENTA`
(
	`ID_REGISTRO` INT NOT NULL AUTO_INCREMENT,
	`FECHA` DATETIME NOT NULL,
	`NOMBRE_CLIENTE` VARCHAR(70) NULL,
	`VALOR_TOTAL_VENTA` BIGINT NOT NULL,
	`ID_INFORME` INT NULL,
	CONSTRAINT `PK_REGISTRO_VENTA` PRIMARY KEY (`ID_REGISTRO` ASC)
)

;

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE `CATEGORIA` 
 ADD CONSTRAINT `UQ_NOMBRE` UNIQUE (`NOMBRE` ASC)
;

ALTER TABLE `DETALLE_FACTURA` 
 ADD INDEX `IXFK_DETALLE_FACTURA_FACTURA` (`ID_FACTURA` ASC)
;

ALTER TABLE `DETALLE_FACTURA` 
 ADD INDEX `IXFK_DETALLE_FACTURA_PRODUCTO` (`ID_PRODUCTO` ASC)
;

ALTER TABLE `DETALLE_INFORME` 
 ADD INDEX `IXFK_DETALLE_INFORME_INFORME` (`ID_INFORME` ASC)
;

ALTER TABLE `DETALLE_INFORME` 
 ADD INDEX `IXFK_DETALLE_INFORME_REGISTRO_VENTA` (`ID_REGISTRO` ASC)
;

ALTER TABLE `DETALLE_VENTA` 
 ADD INDEX `IXFK_DETALLE _VENTA_PRODUCTO` (`ID_PRODUCTO` ASC)
;

ALTER TABLE `DETALLE_VENTA` 
 ADD INDEX `IXFK_DETALLE _VENTA_REGISTRO_VENTA` (`ID_REGISTRO` ASC)
;

ALTER TABLE `INFORME` 
 ADD CONSTRAINT `UQ_FECHA` UNIQUE (`FECHA` ASC)
;

ALTER TABLE `PRODUCTO` 
 ADD INDEX `IXFK_PRODUCTO_CATEGORIA` (`ID_CATEGORIA` ASC)
;

ALTER TABLE `REGISTRO_VENTA` 
 ADD INDEX `IXFK_REGISTRO_VENTA_CLIENTE` (`NOMBRE_CLIENTE` ASC)
;

ALTER TABLE `REGISTRO_VENTA` 
 ADD INDEX `IXFK_REGISTRO_VENTA_INFORME` (`ID_INFORME` ASC)
;

/* Create Foreign Key Constraints */

ALTER TABLE `DETALLE_FACTURA` 
 ADD CONSTRAINT `FK_DETALLE_FACTURA_FACTURA`
	FOREIGN KEY (`ID_FACTURA`) REFERENCES `FACTURA` (`ID_FACTURA`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `DETALLE_FACTURA` 
 ADD CONSTRAINT `FK_DETALLE_FACTURA_PRODUCTO`
	FOREIGN KEY (`ID_PRODUCTO`) REFERENCES `PRODUCTO` (`ID_PRODUCTO`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `DETALLE_INFORME` 
 ADD CONSTRAINT `FK_DETALLE_INFORME_INFORME`
	FOREIGN KEY (`ID_INFORME`) REFERENCES `INFORME` (`ID_INFORME`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `DETALLE_INFORME` 
 ADD CONSTRAINT `FK_DETALLE_INFORME_REGISTRO_VENTA`
	FOREIGN KEY (`ID_REGISTRO`) REFERENCES `REGISTRO_VENTA` (`ID_REGISTRO`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `DETALLE_VENTA` 
 ADD CONSTRAINT `FK_DETALLE _VENTA_PRODUCTO`
	FOREIGN KEY (`ID_PRODUCTO`) REFERENCES `PRODUCTO` (`ID_PRODUCTO`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `DETALLE_VENTA` 
 ADD CONSTRAINT `FK_DETALLE _VENTA_REGISTRO_VENTA`
	FOREIGN KEY (`ID_REGISTRO`) REFERENCES `REGISTRO_VENTA` (`ID_REGISTRO`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `PRODUCTO` 
 ADD CONSTRAINT `FK_PRODUCTO_CATEGORIA`
	FOREIGN KEY (`ID_CATEGORIA`) REFERENCES `CATEGORIA` (`ID_CATEGORIA`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `REGISTRO_VENTA` 
 ADD CONSTRAINT `FK_REGISTRO_VENTA_INFORME`
	FOREIGN KEY (`ID_INFORME`) REFERENCES `INFORME` (`ID_INFORME`) ON DELETE Restrict ON UPDATE Restrict
;

SET FOREIGN_KEY_CHECKS=1 
;
